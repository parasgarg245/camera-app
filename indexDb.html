<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    
    <input type="text" placeholder="db" id='name' value="db">
    <input type="number" id="version" placeholder="1.0" value="1">
    <button id="create">create</button>
    
    <hr />
        
    <input type="text" placeholder="your note" id="note">
    <button id="add">Add Note</button>
        
    <script>
    
    let name=document.querySelector('#name')
    let version=document.querySelector('#version')
    let btn=document.querySelector('button#create')
    
    let note=document.querySelector('#note')
    let addbtn=document.querySelector('#add')
    
   
    
    let db ,v,dbAccess;
    
    
    addbtn.addEventListener('click',function(){
        let val=note.value;
        if(!dbAccess){
            alert('please open database')
            return 
        }
        
        let tx=dbAccess.transaction('cs','readwrite')
        let csObjectStore=tx.objectStore('cs')
        let data={
            nId:Date.now(),
            noteVal:val
            
        }
        csObjectStore.add(data)
    })
    
    
    btn.addEventListener('click',()=>{
        
        db=name.value;
        v=version.value;
        
        let request=indexedDB.open(db,v)
        
        request.addEventListener('success',()=>{
            alert('db is created')
             dbAccess=request.result
             viewNotes()
            
        })
        //version ka kam hai kitni bar upgrade hua hai aur ye kabhi b phle vale se kam nhi ho skta 
        
        //version increase karna and new database bnana
        request.addEventListener('upgradeneeded',()=>{
            alert('update is occured')
            let db=request.result  ////// access lene k lia
            // db.createObjectStore('cs',{keyPath:'nId'})
        })

        
        
        // agar hum previous par jare hai ya usi par hai
        request.addEventListener('error',()=>{
        
            alert('some error occured')
        })
        
    })
    
    
    
    
    function viewNotes(){
    
        let tx=dbAccess.transaction('cs','readonly')
        let csObjectStore=tx.objectStore('cs')
        let req=csObjectStore.openCursor()
        
        req.addEventListener('success',function(){
            let cursor=req.result;
            if(cursor){
                console.log(cursor)
                cursor.continue()
            }
        })
    
    
    
    }
    
    
    
    </script>
    
</body>
</html>